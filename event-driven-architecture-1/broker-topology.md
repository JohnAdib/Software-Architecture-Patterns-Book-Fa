# توپولوژی کارگزار

```
توپولوژی بروکر با توپولوژی واسطه تفاوت دارد
میانجی رویداد مرکزی وجود ندارد. در عوض، جریان پیام در سراسر اجزای پردازشگر رویداد به صورت زنجیره ای توزیع می شود
مد را از طریق یک واسطه پیام سبک وزن (به عنوان مثال، ActiveMQ، HornetQ، و غیره).
این توپولوژی زمانی مفید است که شما یک جریان پردازش رویداد نسبتاً ساده دارید و نمی خواهید (یا نیازی به) ارکستراسیون رویداد مرکزی داشته باشید.
```

```
دو نوع اصلی از اجزای معماری در داخل وجود دارد
توپولوژی کارگزار: یک جزء کارگزار و یک جزء پردازشگر رویداد.
جزء بروکر می تواند متمرکز یا فدرال باشد و شامل تمام کانال های رویدادی است که در جریان رویداد استفاده می شود.
کانال های رویداد موجود در جزء کارگزار می توانند باشند
صف های پیام، موضوعات پیام یا ترکیبی از هر دو.
```

```
این توپولوژی در شکل 2-3 نشان داده شده است. همانطور که از نمودار می بینید، هیچ مولفه میانجی رویداد مرکزی کنترل کننده ای وجود ندارد
و سازماندهی رویداد اولیه؛ بلکه هر رویداد-پردازنده
جزء مسئول پردازش یک رویداد و انتشار یک
رویداد جدید نشان‌دهنده عملکردی است که به تازگی انجام داده است.
به عنوان مثال، یک پردازشگر رویداد که یک سبد سهام را متعادل می کند ممکن است یک رویداد اولیه به نام تقسیم سهام را دریافت کند. بر اساس آن رویداد اولیه، پردازشگر رویداد ممکن است مقداری توازن مجدد پورتفولیو انجام دهد، و سپس رویداد جدیدی به نام rebalance portfolio را برای کارگزار منتشر کند، که سپس توسط یک پردازشگر رویداد دیگر انتخاب می‌شود. توجه داشته باشید که ممکن است مواردی وجود داشته باشد که رویدادی توسط یک پردازشگر رویداد منتشر شود اما توسط هیچ پردازشگر رویداد دیگری انتخاب نشود. این امر زمانی رایج است که در حال توسعه یک برنامه یا ارائه عملکردها و برنامه های افزودنی آینده هستید.
```

```
برای نشان دادن اینکه توپولوژی بروکر چگونه کار می کند، از همان استفاده خواهیم کرد
به عنوان مثال در توپولوژی واسطه (یک شخص بیمه شده حرکت می کند).
از آنجایی که هیچ واسطه رویداد مرکزی برای دریافت رویداد اولیه وجود ندارد
توپولوژی کارگزار، جزء مشتری-فرایند را دریافت می کند
رویداد مستقیماً، آدرس مشتری را تغییر می‌دهد و رویدادی را ارسال می‌کند
گفتن اینکه آدرس مشتری را تغییر داده است (به عنوان مثال، تغییر رویداد آدرس).
در این مثال، دو پردازنده رویداد وجود دارد که به آنها علاقه مند هستند
رویداد تغییر آدرس: فرآیند نقل قول و فرآیند ادعاها.
جزء پردازشگر مظنه، نرخ های جدید بیمه خودرو را بر اساس تغییر آدرس دوباره محاسبه می کند و یک رویداد را منتشر می کند
به بقیه سیستم نشان می دهد که چه کاری انجام داده است (به عنوان مثال، نقل قول مجدد محاسبه شود
رویداد).
از طرف دیگر، مؤلفه رسیدگی به خسارت، همان رویداد آدرس تغییر را دریافت می‌کند، اما در این حالت، یک ادعای بیمه معوق را به‌روزرسانی می‌کند و یک رویداد را در سیستم منتشر می‌کند.
یک رویداد ادعای به‌روزرسانی این رویدادهای جدید سپس توسط دیگران انتخاب می شوند
اجزای پردازشگر رویداد، و زنجیره رویداد همچنان ادامه دارد
سیستم تا زمانی که هیچ رویداد دیگری برای آن رویداد آغازگر خاص منتشر نشود.
```

```
همانطور که از شکل 2-4 می بینید، توپولوژی کارگزار همه چیز در مورد آن است
زنجیره ای از رویدادها برای انجام یک عملکرد تجاری.
بهترین راه برای درک توپولوژی بروکر این است که در مورد آن به عنوان یک مسابقه رله فکر کنید.
در مسابقه امدادی، دوندگان باتوم را در دست می گیرند و برای مسافت مشخصی می دوند.
سپس باتوم را به دونده بعدی تحویل دهید، و به همین ترتیب پایین
زنجیره بزنید تا آخرین دونده از خط پایان عبور کند.
در مسابقات رله، زمانی که یک دونده باتوم را از دست می دهد، مسابقه را تمام می کند.
این در مورد توپولوژی بروکر نیز صادق است: هنگامی که یک پردازشگر رویداد رویداد را متوقف می کند، دیگر درگیر پردازش آن رویداد خاص نیست.
```

# توپولوژی میانجی

```
توپولوژی واسطه برای رویدادهایی که دارای چندین مرحله هستند مفید است
و برای پردازش رویداد نیاز به سطحی از ارکستراسیون دارد.
به عنوان مثال، یک رویداد واحد برای انجام معامله سهام ممکن است به شما نیاز داشته باشد
ابتدا معامله را تأیید کنید، سپس مطابقت آن معامله سهام را بررسی کنید
در برابر قوانین انطباق مختلف، معامله را به یک کارگزار واگذار کنید،
کمیسیون را محاسبه کنید و در نهایت معامله را با آن کارگزار انجام دهید. همه این مراحل به سطحی از ارکستراسیون نیاز دارند
ترتیب مراحل را مشخص کنید و اینکه کدام یک را می توان به صورت سریالی و موازی انجام داد.
```

```
چهار نوع اصلی از اجزای معماری در داخل توپولوژی واسطه وجود دارد:
صف های رویداد، میانجی رویداد، کانال های رویداد و پردازنده های رویداد.
جریان رویداد با ارسال یک رویداد به یک صف رویداد توسط مشتری شروع می شود که برای انتقال رویداد به میانجی رویداد استفاده می شود.
واسطه رویداد، رویداد اولیه را دریافت می‌کند و با ارسال رویدادهای ناهمزمان اضافی به کانال‌های رویداد برای اجرای هر مرحله از فرآیند، آن رویداد را هماهنگ می‌کند.
پردازنده‌های رویداد، که در کانال‌های رویداد گوش می‌دهند، رویداد را از واسطه رویداد دریافت می‌کنند و منطق تجاری خاصی را برای پردازش رویداد اجرا می‌کنند.
شکل 2-1 توپولوژی میانجی کلی الگوی معماری رویداد محور را نشان می دهد.
```

```
وجود یک دوجین تا چند صد صف رویداد در یک معماری رویداد محور معمول است.
الگو اجرای جزء صف رویداد را مشخص نمی کند.
این می تواند یک صف پیام، یک نقطه پایانی وب سرویس یا هر ترکیبی از آنها باشد.
```

```
دو نوع رویداد در این الگو وجود دارد: یک رویداد اولیه و یک رویداد پردازش.
رویداد اولیه رویداد اصلی دریافت شده توسط میانجی است، در حالی که رویدادهای پردازش رویدادهایی هستند که توسط میانجی ایجاد شده و توسط اجزای پردازش رویداد دریافت می‌شوند.
```

```
مؤلفه میانجی رویداد مسئول هماهنگی است
مراحل موجود در رویداد اولیه برای هر مرحله در رویداد اولیه، واسطه رویداد یک رویداد پردازشی خاص را ارسال می کند
به یک کانال رویداد، که سپس دریافت و پردازش می شود
پردازنده رویداد ذکر این نکته ضروری است که میانجی رویداد
در واقع منطق تجاری لازم برای پردازش را انجام نمی دهد
رویداد اولیه؛ بلکه از مراحل مورد نیاز برای پردازش رویداد اولیه می داند.
```

```
کانال های رویداد توسط واسطه رویداد به صورت ناهمزمان استفاده می شوند
رویدادهای پردازشی خاص مربوط به هر مرحله را در مرحله اولیه ارسال کنید
رویداد به پردازنده های رویداد.
کانال‌های رویداد می‌توانند صف‌های پیام یا موضوعات پیام باشند، اگرچه موضوعات پیام بیشتر با توپولوژی واسطه استفاده می‌شوند، به طوری که رویدادهای پردازش می‌توانند توسط چندین پردازشگر رویداد پردازش شوند.
(هر کدام یک کار متفاوت را بر اساس رویداد پردازش دریافتی انجام می دهند).
```

```
اجزای پردازشگر رویداد شامل کسب و کار برنامه است
منطق لازم برای پردازش رویداد پردازش. پردازنده‌های رویداد اجزای معماری مستقل، مستقل و بسیار جداشده‌ای هستند که وظیفه خاصی را در برنامه یا سیستم انجام می‌دهند.
در حالی که دانه بندی جزء رویداد-پردازنده می تواند متفاوت باشد
از ریزدانه (به عنوان مثال، محاسبه مالیات فروش بر روی یک سفارش)
به طور کلی (به عنوان مثال، رسیدگی به ادعای بیمه)، مهم است که به خاطر داشته باشید که به طور کلی، هر جزء پردازشگر رویداد باید یک وظیفه تجاری واحد را انجام دهد و برای تکمیل وظیفه خاص خود به پردازشگرهای رویداد دیگر متکی نباشد.
```

```
میانجی رویداد را می توان به روش های مختلفی اجرا کرد.
به عنوان یک معمار، شما باید هر یک از این پیاده سازی ها را درک کنید
گزینه هایی برای اطمینان از اینکه راه حلی که برای رویداد انتخاب می کنید
میانجی با نیازها و نیازهای شما مطابقت دارد.
```

```
ساده ترین و رایج ترین پیاده سازی میانجی رویداد از طریق هاب های یکپارچه سازی منبع باز مانند Spring Integration، Apache Camel یا Mule ESB است. جریان های رویداد در این هاب های یکپارچه سازی منبع باز معمولاً از طریق کد جاوا یا یک DSL (زبان مخصوص دامنه) پیاده سازی می شوند. برای میانجی‌گری و هماهنگ‌سازی پیچیده‌تر، می‌توانید از BPEL (زبان اجرای فرآیند تجاری) همراه با موتور BPEL مانند Apache ODE منبع باز استفاده کنید. BPEL یک زبان استاندارد XML است که داده ها و مراحل مورد نیاز برای پردازش یک رویداد اولیه را توصیف می کند. برای برنامه های بسیار بزرگ که به هماهنگی بسیار پیچیده تری نیاز دارند (از جمله مراحل مربوط به تعاملات انسانی)، می توانید میانجی رویداد را با استفاده از یک مدیر فرآیند کسب و کار (BPM) مانند jBPM پیاده سازی کنید.
```

```
درک نیازهای شما و تطبیق آنها با رویداد صحیح
پیاده سازی واسطه برای موفقیت هر معماری رویداد محور با استفاده از این توپولوژی حیاتی است. استفاده از یک هاب یکپارچه سازی منبع باز برای انجام مدیریت فرآیندهای تجاری بسیار پیچیده
ارکستراسیون دستوری برای شکست است، درست مانند اجرای BPM
راه حل برای اجرای منطق مسیریابی ساده
```

```
برای نشان دادن نحوه عملکرد توپولوژی واسطه، فرض کنید شما هستید
از طریق یک شرکت بیمه بیمه شده و تصمیم به نقل مکان می گیرید. که در
در این مورد، رویداد اولیه ممکن است چیزی شبیه جابجایی نامیده شود
رویداد. مراحل مربوط به پردازش یک رویداد جابجایی عبارتند از
همانطور که در شکل 2-2 نشان داده شده است. برای هر
مرحله اولیه رویداد، واسطه رویداد یک رویداد پردازشی ایجاد می کند
(به عنوان مثال، تغییر آدرس، نقل قول مجدد محاسبه، و غیره)، رویداد پردازش را به کانال رویداد ارسال می کند و منتظر می ماند تا رویداد پردازش توسط پردازشگر رویداد مربوطه پردازش شود.
(به عنوان مثال، فرآیند مشتری، فرآیند نقل قول و غیره).
این فرآیند تا زمانی ادامه می یابد که تمام مراحل در رویداد اولیه پردازش شود. نوار تکی روی مراحل نقل قول مجدد و ادعاهای به روز رسانی در میانجی رویداد نشان می دهد که این مراحل می توانند همزمان اجرا شوند.
```
